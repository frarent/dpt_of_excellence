------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  \\delta\jrc\B\B.6\scidata\users\FR\doe\dpt_of_excellence\logs/2025.11.12-17.18.35.l
> og.txt
  log type:  text
 opened on:  12 Nov 2025, 17:18:35

. 
. di "Begin date and time: $S_DATE $S_TIME"
Begin date and time: 12 Nov 2025 17:18:35

. di "Stata version: `c(stata_version)'"
Stata version: 19.5

. di "Updated as of: `c(born_date)'"
Updated as of: 06 Oct 2025

. di "Variant:       `=cond( c(MP),"MP",cond(c(SE),"SE",c(flavor)) )'"
Variant:       MP

. di "Processors:    `c(processors)'"
Processors:    8

. di "OS:            `c(os)' `c(osdtl)'"
OS:            Windows 64-bit

. di "Machine type:  `c(machine_type)'"
Machine type:  PC (64-bit x86-64)

. 
. // Set Date
. global date = subinstr("$S_DATE", " ", "-", .)

. 
. // Version of stata
. version 18

. 
. // Specify Screen Width for log files
. set linesize 255

. 
. // Set Graph Scheme
. graph set window fontface default

. set scheme plotplainblind

. 
. // Set table format
. global tab_fmt html

. 
. // Allow the screen to move without having to click more
. set more off

. 
. // Drop everything in mata
. matrix drop _all

. 
. // Run do files
. *=============================================================================*
. 
. // Run main analysis
. if $analysis == 1 {
.         include $script_path/01_descriptives_table_1.do

. * ====================================================================
. * Author: Francesco Rentocchini and Ugo Rizzo
. * Current Date: 2025-11-12
. * Project Name: Beyond the Badge of Honour: The Effect of the Italian
. * (Department of) Excellence Initiative on Staff Recruitment
. * 
. * Code Description:
. *   Purpose: Produce Table 1 summary statistics for the paper. The code
. *   defines the analytical sample via a weighted reghdfe regression,
. *   scales funding to millions, orders variables, computes means/SDs for
. *   the full sample and key sub-samples, and exports an esttab table.
. * 
. *   Data inputs: ${data_path}/data_for_analysis.dta.
. *   Expected outputs: ${output}/Table_01.${tab_fmt} (esttab table).
. * 
. * ====================================================================
. 
. * --------------------------------------------------
. * Data Import: Load analysis dataset.
. * --------------------------------------------------
. 
. use "${data_path}/data_for_analysis.dta", clear
(Italian Department of Excellence panel data 2013-2020)

. 
. * --------------------------------------------------
. * Setup: Globals and locals for analysis.
. * --------------------------------------------------
. 
. global covar lagi dep_transfer_horizontal tot_premiale VA_percap ///
>     unemp_rate

. global y new_position new_entry new_endogamia new_rtda new_rtdb ///
>     new_ten_uni_all     

. 
. * --------------------------------------------------
. * Analytical Sample: Define via main regression and keep e(sample).
. * --------------------------------------------------
. 
. * Main regression to define analytical sample
. qui reghdfe new_position ib0.treated##i.post2 $covar [pweight=w_ipw_pre], ///
>     absorb(id i.uni_name_enc#i.post2) vce(cluster id)

. keep if e(sample)
(291 observations deleted)

. 
. * --------------------------------------------------
. * Transformations: Scale research funding to millions.
. * --------------------------------------------------
. 
. * Scale research funding to millions
. capture confirm variable tot_premiale

. if !_rc replace tot_premiale = tot_premiale/1000000
variable tot_premiale was long now double
(2,029 real changes made)

. 
. * --------------------------------------------------
. * Variable Order: Locals for dependent vars and controls.
. * --------------------------------------------------
. 
. * Put variables in the exact order
. local depvars  new_position new_entry new_endogamia new_rtda new_rtdb ///
>     new_ten_uni_all

. * # researchers ; # of transfers ; research funding (mil €) ; value added
. * per capita ; unemployment rate
. local ctrls    lagi dep_transfer_horizontal tot_premiale VA_percap ///
>     unemp_rate

. 
. * --------------------------------------------------
. * Summary Statistics: Compute overall and subgroup means/SDs.
. * --------------------------------------------------
. 
. * Compute summary stats for each column
. eststo clear

. estpost summarize `depvars' `ctrls', listwise

             |  e(count)   e(sum_w)    e(mean)     e(Var)      e(sd)     e(min)     e(max)     e(sum) 
-------------+----------------------------------------------------------------------------------------
new_position |      2029       2029   8.234598   28.61851   5.349627          0         43      16708 
   new_entry |      2029       2029    3.01725   6.996251   2.645043          0         16       6122 
new_endoga~a |      2029       2029   4.500739   13.10121   3.619559          0         39       9132 
    new_rtda |      2029       2029   1.509857   3.413118   1.847463          0         15     3063.5 
    new_rtdb |      2029       2029   1.555446   2.695272   1.641728          0         12       3156 
new_ten_un~l |      2029       2029   .8265155   1.221368   1.105155          0         14       1677 
        lagi |      2029       2029   68.04362   692.6903   26.31901         16        236   138060.5 
dep_transf~l |      2029       2029   .3011336   1.234225   1.110957          0         20        611 
tot_premiale |      2029       2029   50.08562   998.0412   31.59179    1.18626   127.7075   101623.7 
   VA_percap |      2029       2029   2.980804   .7394108     .85989   1.329922   5.033033   6048.051 
  unemp_rate |      2029       2029    9.73251   25.29828   5.029739   3.014194   27.80767   19747.26 

. eststo overall

. 
. estpost summarize `depvars' `ctrls' if treated==1, listwise

             |  e(count)   e(sum_w)    e(mean)     e(Var)      e(sd)     e(min)     e(max)     e(sum) 
-------------+----------------------------------------------------------------------------------------
new_position |      1035       1035   8.641546   30.74276   5.544615          0         34       8944 
   new_entry |      1035       1035   3.151691   7.718747   2.778263          0         16       3262 
new_endoga~a |      1035       1035   4.715942   13.62716   3.691499          0         28       4881 
    new_rtda |      1035       1035   1.560386   3.602008   1.897896          0         15       1615 
    new_rtdb |      1035       1035   1.657005   2.911738   1.706381          0         12       1715 
new_ten_un~l |      1035       1035   .8898551   1.370835   1.170827          0         14        921 
        lagi |      1035       1035    69.0971   672.9966   25.94218         16        170    71515.5 
dep_transf~l |      1035       1035   .3188406   1.594567   1.262762          0         20        330 
tot_premiale |      1035       1035   47.81876    1017.09   31.89184    1.18626   127.7075   49492.41 
   VA_percap |      1035       1035   2.988635   .7428836    .861907   1.329922   5.033033   3093.237 
  unemp_rate |      1035       1035   9.623724   23.78345   4.876828   4.272158   27.80767   9960.555 

. eststo tr

. 
. estpost summarize `depvars' `ctrls' if treated==0, listwise

             |  e(count)   e(sum_w)    e(mean)     e(Var)      e(sd)     e(min)     e(max)     e(sum) 
-------------+----------------------------------------------------------------------------------------
new_position |       994        994   7.810865   26.08302   5.107154          0         43       7764 
   new_entry |       994        994   2.877264   6.212514   2.492491          0         14       2860 
new_endoga~a |       994        994    4.27666    12.4682   3.531033          0         39       4251 
    new_rtda |       994        994   1.457243   3.214434   1.792884          0         10     1448.5 
    new_rtdb |       994        994   1.449698   2.450639   1.565452          0          9       1441 
new_ten_un~l |       994        994   .7605634   1.058423   1.028797          0          7        756 
        lagi |       994        994   66.94668   711.5334   26.67458         33        236      66545 
dep_transf~l |       994        994   .2826962   .8595794   .9271351          0         14        281 
tot_premiale |       994        994   52.44599   968.2785   31.11717   4.951156   127.7075   52131.31 
   VA_percap |       994        994    2.97265   .7364087   .8581426   1.329922   5.033033   2954.814 
  unemp_rate |       994        994   9.845783   26.87594   5.184201   3.014194   27.80767   9786.709 

. eststo ct

. 
. estpost summarize `depvars' `ctrls' if LOWdep==1, listwise

             |  e(count)   e(sum_w)    e(mean)     e(Var)      e(sd)     e(min)     e(max)     e(sum) 
-------------+----------------------------------------------------------------------------------------
new_position |       986        986   7.863083   31.51931   5.614206          0         43       7753 
   new_entry |       986        986   2.878296   7.000402   2.645827          0         15       2838 
new_endoga~a |       986        986   4.313387   14.53215   3.812105          0         39       4253 
    new_rtda |       986        986   1.470081   3.805449   1.950756          0         15     1449.5 
    new_rtdb |       986        986   1.458925   2.480291   1.574894          0         10     1438.5 
new_ten_un~l |       986        986   .7738337   1.247274   1.116814          0         14        763 
        lagi |       986        986   67.27485   765.7574   27.67232         33        236      66333 
dep_transf~l |       986        986   .2738337    1.08433   1.041312          0         20        270 
tot_premiale |       986        986   44.10543   968.8926   31.12704    1.18626   127.7075   43487.95 
   VA_percap |       986        986   2.882106     .78664   .8869273   1.329922   5.033033   2841.757 
  unemp_rate |       986        986   10.47282    29.6313   5.443464   3.014194   27.80767    10326.2 

. eststo sec

. 
. estpost summarize `depvars' `ctrls' if LOWdep==0, listwise

             |  e(count)   e(sum_w)    e(mean)     e(Var)      e(sd)     e(min)     e(max)     e(sum) 
-------------+----------------------------------------------------------------------------------------
new_position |      1043       1043    8.58581   25.64978   5.064561          0         33       8955 
   new_entry |      1043       1043    3.14861   6.963499   2.638844          0         16       3284 
new_endoga~a |      1043       1043   4.677852   11.69651   3.420015          0         28       4879 
    new_rtda |      1043       1043   1.547459   3.042611   1.744308          0         11       1614 
    new_rtdb |      1043       1043   1.646692   2.883931   1.698214          0         12     1717.5 
new_ten_un~l |      1043       1043   .8763183   1.192942   1.092219          0          7        914 
        lagi |      1043       1043   68.77037    623.197   24.96391         16        170    71727.5 
dep_transf~l |      1043       1043   .3269415   1.375732   1.172916          0         14        341 
tot_premiale |      1043       1043   55.73899   960.7211    30.9955   2.861703   127.7075   58135.77 
   VA_percap |      1043       1043   3.074108    .677543     .82313   1.329922   5.033033   3206.294 
  unemp_rate |      1043       1043   9.032663   20.21771    4.49641   4.272158   27.80767   9421.067 

. eststo fst

. 
. estpost summarize `depvars' `ctrls' if treated==1 & LOWdep==1, ///
>     listwise

             |  e(count)   e(sum_w)    e(mean)     e(Var)      e(sd)     e(min)     e(max)     e(sum) 
-------------+----------------------------------------------------------------------------------------
new_position |       265        265   9.158491    42.3763   6.509708          0         34       2427 
   new_entry |       265        265   3.475472   9.606404    3.09942          0         15        921 
new_endoga~a |       265        265   4.890566   17.23419   4.151408          0         28       1296 
    new_rtda |       265        265   1.830189   5.370676   2.317472          0         15        485 
    new_rtdb |       265        265   1.718868   3.387521   1.840522          0         10      455.5 
new_ten_un~l |       265        265   .9773585   1.931304   1.389713          0         14        259 
        lagi |       265        265   72.07547   908.8731   30.14752         36        167      19100 
dep_transf~l |       265        265   .3056604   2.213036   1.487628          0         20         81 
tot_premiale |       265        265   32.28713    744.129   27.27873    1.18626   127.7075   8556.089 
   VA_percap |       265        265   2.651259   .8025358   .8958436   1.384153   5.033033   702.5836 
  unemp_rate |       265        265   12.14076   36.35276   6.029325   4.272158   25.83701   3217.302 

. eststo tr_sec

. 
. estpost summarize `depvars' `ctrls' if treated==1 & LOWdep==0, ///
>     listwise

             |  e(count)   e(sum_w)    e(mean)     e(Var)      e(sd)     e(min)     e(max)     e(sum) 
-------------+----------------------------------------------------------------------------------------
new_position |       770        770   8.463636   26.66513   5.163829          0         33       6517 
   new_entry |       770        770    3.04026   7.032187   2.651827          0         16       2341 
new_endoga~a |       770        770   4.655844   12.39246   3.520292          0         28       3585 
    new_rtda |       770        770   1.467532   2.965785   1.722145          0         11       1130 
    new_rtdb |       770        770   1.635714   2.750413   1.658437          0         12     1259.5 
new_ten_un~l |       770        770   .8597403   1.176661    1.08474          0          7        662 
        lagi |       770        770   68.07208   588.7858   24.26491         16        170    52415.5 
dep_transf~l |       770        770   .3233766   1.384238   1.176537          0         12        249 
tot_premiale |       770        770   53.16406   1000.382   31.62881   2.861703   127.7075   40936.32 
   VA_percap |       770        770   3.104745   .6706482   .8189311   1.329922   5.033033   2390.653 
  unemp_rate |       770        770   8.757471    16.5647   4.069976   4.272158   27.80767   6743.253 

. eststo tr_fst

. 
. estpost summarize `depvars' `ctrls' if treated==0 & LOWdep==1, ///
>     listwise

             |  e(count)   e(sum_w)    e(mean)     e(Var)      e(sd)     e(min)     e(max)     e(sum) 
-------------+----------------------------------------------------------------------------------------
new_position |       721        721   7.386963   26.73755   5.170837          0         43       5326 
   new_entry |       721        721   2.658807   5.875092   2.423859          0         14       1917 
new_endoga~a |       721        721   4.101248    13.3939   3.659768          0         39       2957 
    new_rtda |       721        721   1.337725   3.171547   1.780884          0         10      964.5 
    new_rtdb |       721        721   1.363384   2.117074   1.455017          0          9        983 
new_ten_un~l |       721        721   .6990291   .9773463   .9886083          0          6        504 
        lagi |       721        721    65.5104   702.7454   26.50935         33        236      47233 
dep_transf~l |       721        721   .2621359   .6714671    .819431          0         10        189 
tot_premiale |       721        721   48.44919     982.35   31.34246   5.799735   127.7075   34931.86 
   VA_percap |       721        721   2.966953   .7550812   .8689541   1.329922   5.033033   2139.173 
  unemp_rate |       721        721    9.85977   25.80762   5.080121   3.014194   27.80767   7108.894 

. eststo ct_sec

. 
. estpost summarize `depvars' `ctrls' if treated==0 & LOWdep==0, ///
>     listwise

             |  e(count)   e(sum_w)    e(mean)     e(Var)      e(sd)     e(min)     e(max)     e(sum) 
-------------+----------------------------------------------------------------------------------------
new_position |       273        273   8.930403   22.71205   4.765716          0         23       2438 
   new_entry |       273        273   3.454212   6.667933   2.582234          0         11        943 
new_endoga~a |       273        273   4.739927   9.766672   3.125168          0         17       1294 
    new_rtda |       273        273   1.772894    3.20191   1.789388          0          9        484 
    new_rtdb |       273        273   1.677656   3.270712   1.808511          0          9        458 
new_ten_un~l |       273        273   .9230769   1.240385   1.113726          0          7        252 
        lagi |       273        273   70.73993    717.502   26.78623         35        160      19312 
dep_transf~l |       273        273   .3369963   1.356604   1.164734          0         14         92 
tot_premiale |       273        273   63.00164   780.4149   27.93591   4.951156   118.8654   17199.45 
   VA_percap |       273        273   2.987696   .6893755   .8302864   1.563224   5.033033   815.6411 
  unemp_rate |       273        273   9.808844   29.80077   5.459008   4.356454   24.61042   2677.814 

. eststo ct_fst

. 
. * --------------------------------------------------
. * Table Output: Export esttab summary statistics table.
. * --------------------------------------------------
. 
. esttab overall tr ct sec fst tr_sec tr_fst ct_sec ct_fst using ///
>     "${output}/Table_01.${tab_fmt}", replace style(html) label noobs ///
>     nonumber collabels(none) mtitle("overall (1)" "treated (2)" ///
>     "untreated (3)" "second-tier (4)" "first-tier (5)" ///
>     "treated second-tier (6)" "treated first-tier (7)" ///
>     "untreated second-tier (8)" "untreated first-tier (9)") ///
>     cells("mean(fmt(2)) sd(par fmt(2))") ///
>     stats(N, labels("Observations") fmt(0)) ///
>     addnotes("Notes. Table shows summary statistics for the full sample (column 1) and for several sub-samples. Sub-samples are: treated (column 2) and untreated (column 3) departments, second- (column 4) and first-tier departments (column 5), treated s
> econd – (column 6) and treated first-tier departments (column 7), untreated second – (column 8) and untreated first-tier departments (column 9). Summary statistics are means and standard deviations (in parentheses).") ///
>     title("Table 1: Summary statistics, full sample and sub-samples") ///
>     varlabels( ///
>         new_position        "New positions" ///
>         new_entry           "New positions (excl. promotions)" ///
>         new_endogamia       "Internal promotions" ///
>         new_rtda            "Temporary" ///
>         new_rtdb            "Tenure track" ///
>         new_ten_uni_all     "Tenured" ///
>         lagi                "# researchers" ///
>         dep_transfer_horizontal "# of transfers" ///
>         tot_premiale        "research funding (mil &euro;)" ///
>         VA_percap           "value added per capita" ///
>         unemp_rate          "unemployment rate" ///
>     ) ///
>     refcat(new_position "Dependent variables" lagi "Control variables", ///
>     nolabel)
(file output/Table_01.html not found)
(output written to output/Table_01.html)

. .         include $script_path/02_estimates_tables_2to5.do

. * --------------------------------------------------
. * Author: Francesco Rentocchini and Ugo Rizzo
. * Current Date: 12 Nov 2025
. * Project Name: Beyond the Badge of Honour: The Effect of the Italian
. * (Department of) Excellence Initiative on Staff Recruitment
. * 
. * Code Description:
. * Purpose: Estimate DD and DDD effects of the Department of Excellence
. * programme on university staff recruitment outcomes.
. * 
. * Data inputs: ${data_path}/data_for_analysis.dta, including treatment
. * indicators (treated, post2), department IDs (id), university IDs
. * (uni_name_enc), covariates (lagi, dep_transfer_horizontal,
. * tot_premiale, VA_percap, unemp_rate), propensity score weights
. * (w_ipw_pre), and outcome variables grouped in globals y, y1, y2.
. * 
. * Outputs: Regression result tables saved to 
. * ${output}/Table_02.${tab_fmt},
. * ${output}/Table_03.${tab_fmt}, ${output}/Table_04.${tab_fmt},
. * and ${output}/Table_05.${tab_fmt}.
. * --------------------------------------------------
. 
. * --------------------------------------------------
. * SET GLOBALS AND LOCALS FOR ANALYSIS
. * --------------------------------------------------
. 
. global covar lagi dep_transfer_horizontal tot_premiale VA_percap ///
>     unemp_rate

. 
. global y new_position new_entry new_endogamia new_rtda new_rtdb ///
>     new_ten_uni_all     

. 
. 
. global y1 est*_new_position est*_new_entry est*_new_endogamia

. global y2 est*_new_rtda est*_new_rtdb est*_new_ten_uni_all

. 
. global plot_y1 est3_new_position est3_new_entry est3_new_endogamia      

. global plot_y2 est3_new_rtda est3_new_rtdb est3_new_ten_uni_all

. 
. * p hat in notes to tables
. local hat = uchar(770)              

. local phat = "p`hat'"

. 
. * --------------------------------------------------
. * Data Import: Loading raw data from external sources.
. * --------------------------------------------------
. use "${data_path}/data_for_analysis.dta", clear
(Italian Department of Excellence panel data 2013-2020)

. 
. 
. * --------------------------------------------------
. * Difference-in-Differences (DD) Estimation: Overall
. * --------------------------------------------------
. 
. cap est drop _all

. 
. foreach var of global y {
  2. 
.     * Department and year fixed effects
.     qui reghdfe `var' ib0.treated##i.post2 $covar, ///
>         a(id) cluster(id)
  3.     estadd local dptyear "Yes"
  4.     estadd local contr "Yes"
  5.     estadd local univyear "No"
  6.     estadd local pscore "No"
  7.     est store est1_`var'
  8. 
.     * Add university-by-year fixed effects
.     qui reghdfe `var' ib0.treated##i.post2 $covar, ///
>         a(id i.uni_name_enc#i.post2) cluster(id)
  9.     estadd local dptyear "Yes"
 10.     estadd local contr "Yes"
 11.     estadd local univyear "Yes"
 12.     estadd local pscore "No"
 13.     est store est2_`var'
 14. 
.     * Add propensity score weights
.     qui reghdfe `var' ib0.treated##i.post2 $covar ///
>         [pweight=w_ipw_pre], ///
>         a(id i.uni_name_enc#i.post2) cluster(id)
 15.     estadd local dptyear "Yes"
 16.     estadd local contr "Yes"
 17.     estadd local univyear "Yes"
 18.     estadd local pscore "Yes"
 19.     est store est3_`var'
 20. }

added macro:
            e(dptyear) : "Yes"

added macro:
              e(contr) : "Yes"

added macro:
           e(univyear) : "No"

added macro:
             e(pscore) : "No"

added macro:
            e(dptyear) : "Yes"

added macro:
              e(contr) : "Yes"

added macro:
           e(univyear) : "Yes"

added macro:
             e(pscore) : "No"

added macro:
            e(dptyear) : "Yes"

added macro:
              e(contr) : "Yes"

added macro:
           e(univyear) : "Yes"

added macro:
             e(pscore) : "Yes"

added macro:
            e(dptyear) : "Yes"

added macro:
              e(contr) : "Yes"

added macro:
           e(univyear) : "No"

added macro:
             e(pscore) : "No"

added macro:
            e(dptyear) : "Yes"

added macro:
              e(contr) : "Yes"

added macro:
           e(univyear) : "Yes"

added macro:
             e(pscore) : "No"

added macro:
            e(dptyear) : "Yes"

added macro:
              e(contr) : "Yes"

added macro:
           e(univyear) : "Yes"

added macro:
             e(pscore) : "Yes"

added macro:
            e(dptyear) : "Yes"

added macro:
              e(contr) : "Yes"

added macro:
           e(univyear) : "No"

added macro:
             e(pscore) : "No"

added macro:
            e(dptyear) : "Yes"

added macro:
              e(contr) : "Yes"

added macro:
           e(univyear) : "Yes"

added macro:
             e(pscore) : "No"

added macro:
            e(dptyear) : "Yes"

added macro:
              e(contr) : "Yes"

added macro:
           e(univyear) : "Yes"

added macro:
             e(pscore) : "Yes"

added macro:
            e(dptyear) : "Yes"

added macro:
              e(contr) : "Yes"

added macro:
           e(univyear) : "No"

added macro:
             e(pscore) : "No"

added macro:
            e(dptyear) : "Yes"

added macro:
              e(contr) : "Yes"

added macro:
           e(univyear) : "Yes"

added macro:
             e(pscore) : "No"

added macro:
            e(dptyear) : "Yes"

added macro:
              e(contr) : "Yes"

added macro:
           e(univyear) : "Yes"

added macro:
             e(pscore) : "Yes"

added macro:
            e(dptyear) : "Yes"

added macro:
              e(contr) : "Yes"

added macro:
           e(univyear) : "No"

added macro:
             e(pscore) : "No"

added macro:
            e(dptyear) : "Yes"

added macro:
              e(contr) : "Yes"

added macro:
           e(univyear) : "Yes"

added macro:
             e(pscore) : "No"

added macro:
            e(dptyear) : "Yes"

added macro:
              e(contr) : "Yes"

added macro:
           e(univyear) : "Yes"

added macro:
             e(pscore) : "Yes"

added macro:
            e(dptyear) : "Yes"

added macro:
              e(contr) : "Yes"

added macro:
           e(univyear) : "No"

added macro:
             e(pscore) : "No"

added macro:
            e(dptyear) : "Yes"

added macro:
              e(contr) : "Yes"

added macro:
           e(univyear) : "Yes"

added macro:
             e(pscore) : "No"

added macro:
            e(dptyear) : "Yes"

added macro:
              e(contr) : "Yes"

added macro:
           e(univyear) : "Yes"

added macro:
             e(pscore) : "Yes"

. 
. * --------------------------------------------------
. * Table 2 - DD on Faculty Recruitment
. * --------------------------------------------------
. 
. esttab $y1 using "${output}/Table_02.${tab_fmt}", ///
>     keep(1.treated#* lagi dep_transfer_horizontal tot_premiale ///
>          VA_percap unemp_rate) ///
>     starlevels(+ 0.1 * 0.05 ** 0.01) ///
>     drop(1.treated#0.post2) ///
>     varlabels( ///
>         1.treated#1.post2 "Treat X After" ///
>         lagi "# researchers" ///
>         dep_transfer_horizontal "# of transfers" ///
>         tot_premiale "amount of research funding" ///
>         VA_percap "value added per capita" ///
>         unemp_rate "unemployment rate") ///
>     cells(b(star fmt(3)) se(par([ ]) fmt(3))) ///
>     legend collabels(, none) ///
>     stats(dptyear contr univyear pscore N_clust, ///
>         labels("Department and post FE" ///
>                "Time-varying controls" ///
>                "University-by-post FE" ///
>                "Prop score weight" ///
>                "N (Departments)") fmt(0 0 0 0 0)) ///
>     addnotes("Notes. This table displays the average treatment on the treated coefficient using 2014-2020 data. Regressions are based on 2,029 department-year observations. Estimates include controls for the number of employees at t-1, the number of sta
> ff transferred between departments, university income linked to the VQR, province-level per-capita value added and provincial unemployment rate. Department, post treatement fixed effects are included in all specifications. Columns 2, 3, 5, 6, 8 and 9 al
> so include university-by-post fixed effects. Regressions in columns 3, 6 and 9 are estimated using 1/(1-`phat'(x<sub>i</sub>)) to weight untreated observations and 1/`phat'(x<sub>i</sub>) otherwise. `phat'(x<sub>i</sub>) is the propensity score and is c
> alculated controlling for the number of department research staff at time t-1, the number of staff transferred between departments, university income linked to the VQR, province-level per-capita value added, provincial unemployment rate and NUTS 1 regio
> nal fixed effects. Standard errors clustered at the department level are in parentheses. ") ///
>     nogaps onecell ///
>     label ///
>     title("Table 2: Effect of the Department of Excellence Programme on University Faculty Recruitment: new positions and internal promotions") ///
>     replace
(file output/Table_02.html not found)
(output written to output/Table_02.html)

. 
. * --------------------------------------------------
. * Table 3 - DD on Temporary & Tenure-Track
. * --------------------------------------------------
. 
. esttab $y2 using "${output}/Table_03.${tab_fmt}", ///
>     keep(1.treated#* lagi dep_transfer_horizontal tot_premiale ///
>          VA_percap unemp_rate) ///
>     starlevels(+ 0.1 * 0.05 ** 0.01) ///
>     drop(1.treated#0.post2) ///
>     varlabels( ///
>         1.treated#1.post2 "Treat X After" ///
>         lagi "# researchers" ///
>         dep_transfer_horizontal "# of transfers" ///
>         tot_premiale "amount of research funding" ///
>         VA_percap "value added per capita" ///
>         unemp_rate "unemployment rate") ///
>     cells(b(star fmt(3)) se(par([ ]) fmt(3))) ///
>     legend collabels(, none) ///
>     stats(dptyear contr univyear pscore N_clust, ///
>         labels("Department and post FE" ///
>                "Time-varying controls" ///
>                "University-by-post FE" ///
>                "Prop score weight" ///
>                "N (Departments)") fmt(0 0 0 0 0)) ///
>     addnotes("Notes. This table displays the average treatment on the treated coefficients using 2014-2020 data. Regressions are based on 2,029 department-year observations. Estimates include controls for the number of employees at t-1, the number of st
> aff transferred between departments, university income linked to the VQR, province-level per-capita value added and provincial unemployment rate. Department, post treatment fixed effects are included in all specifications. Columns 2, 3, 5, 6, 8 and 9 al
> so include university-by-post fixed effects. Regressions in columns 3, 6 and 9 are estimated using 1/(1-`phat'(x<sub>i</sub>)) to weight untreated observations and 1/`phat'(x<sub>i</sub>) otherwise. `phat'(x<sub>i</sub>) is the propensity score and is c
> alculated controlling for the number of department research staff at time t-1, the number of staff transferred between departments, university income linked to the VQR, province-level per-capita value added, provincial unemployment rate and NUTS 1 regio
> nal fixed effects. Standard errors clustered at the department level are in parentheses") ///
>     nogaps onecell ///
>     label ///
>     title("Table 3 Effect of the Department of Excellence Programme on University Faculty Recruitment: temporary and permanent positions") ///
>     replace
(file output/Table_03.html not found)
(output written to output/Table_03.html)

. 
. 
. * --------------------------------------------------
. * Difference-in-Difference-in-Differences (DDD):
. * Second Tier University Departments
. * --------------------------------------------------
. 
. cap est drop _all

. 
. foreach var of global y {
  2. 
.     * Base DDD model
.     qui reghdfe `var' ib0.treated##i.LOWdep##i.post2 $covar, ///
>         a(id i.post2) cluster(id)
  3.     estadd scalar ftest = r(p)
  4.     estadd local dptyear "Yes"
  5.     estadd local contr "Yes"
  6.     estadd local univyear "No"
  7.     estadd local pscore "No"
  8.     est store est1_`var'
  9. 
.     * Add university-by-year FE
.     qui reghdfe `var' ib0.treated##i.LOWdep##i.post2 $covar, ///
>         a(id i.post2 i.uni_name_enc#i.post2) cluster(id)
 10.     estadd scalar ftest = r(p)
 11.     estadd local dptyear "Yes"
 12.     estadd local contr "Yes"
 13.     estadd local univyear "Yes"
 14.     estadd local pscore "No"
 15.     est store est2_`var'
 16. 
.     * Add propensity score weights
.     qui reghdfe `var' ib0.treated##i.LOWdep##i.post2 $covar ///
>         [pweight=w_ipw_pre], ///
>         a(id i.post2 i.uni_name_enc#i.post2) cluster(id)
 17.     estadd scalar ftest = r(p)
 18.     estadd local dptyear "Yes"
 19.     estadd local contr "Yes"
 20.     estadd local univyear "Yes"
 21.     estadd local pscore "Yes"
 22.     est store est3_`var'
 23. }

added scalar:
              e(ftest) =  .

added macro:
            e(dptyear) : "Yes"

added macro:
              e(contr) : "Yes"

added macro:
           e(univyear) : "No"

added macro:
             e(pscore) : "No"

added scalar:
              e(ftest) =  .

added macro:
            e(dptyear) : "Yes"

added macro:
              e(contr) : "Yes"

added macro:
           e(univyear) : "Yes"

added macro:
             e(pscore) : "No"

added scalar:
              e(ftest) =  .

added macro:
            e(dptyear) : "Yes"

added macro:
              e(contr) : "Yes"

added macro:
           e(univyear) : "Yes"

added macro:
             e(pscore) : "Yes"

added scalar:
              e(ftest) =  .

added macro:
            e(dptyear) : "Yes"

added macro:
              e(contr) : "Yes"

added macro:
           e(univyear) : "No"

added macro:
             e(pscore) : "No"

added scalar:
              e(ftest) =  .

added macro:
            e(dptyear) : "Yes"

added macro:
              e(contr) : "Yes"

added macro:
           e(univyear) : "Yes"

added macro:
             e(pscore) : "No"

added scalar:
              e(ftest) =  .

added macro:
            e(dptyear) : "Yes"

added macro:
              e(contr) : "Yes"

added macro:
           e(univyear) : "Yes"

added macro:
             e(pscore) : "Yes"

added scalar:
              e(ftest) =  .

added macro:
            e(dptyear) : "Yes"

added macro:
              e(contr) : "Yes"

added macro:
           e(univyear) : "No"

added macro:
             e(pscore) : "No"

added scalar:
              e(ftest) =  .

added macro:
            e(dptyear) : "Yes"

added macro:
              e(contr) : "Yes"

added macro:
           e(univyear) : "Yes"

added macro:
             e(pscore) : "No"

added scalar:
              e(ftest) =  .

added macro:
            e(dptyear) : "Yes"

added macro:
              e(contr) : "Yes"

added macro:
           e(univyear) : "Yes"

added macro:
             e(pscore) : "Yes"

added scalar:
              e(ftest) =  .

added macro:
            e(dptyear) : "Yes"

added macro:
              e(contr) : "Yes"

added macro:
           e(univyear) : "No"

added macro:
             e(pscore) : "No"

added scalar:
              e(ftest) =  .

added macro:
            e(dptyear) : "Yes"

added macro:
              e(contr) : "Yes"

added macro:
           e(univyear) : "Yes"

added macro:
             e(pscore) : "No"

added scalar:
              e(ftest) =  .

added macro:
            e(dptyear) : "Yes"

added macro:
              e(contr) : "Yes"

added macro:
           e(univyear) : "Yes"

added macro:
             e(pscore) : "Yes"

added scalar:
              e(ftest) =  .

added macro:
            e(dptyear) : "Yes"

added macro:
              e(contr) : "Yes"

added macro:
           e(univyear) : "No"

added macro:
             e(pscore) : "No"

added scalar:
              e(ftest) =  .

added macro:
            e(dptyear) : "Yes"

added macro:
              e(contr) : "Yes"

added macro:
           e(univyear) : "Yes"

added macro:
             e(pscore) : "No"

added scalar:
              e(ftest) =  .

added macro:
            e(dptyear) : "Yes"

added macro:
              e(contr) : "Yes"

added macro:
           e(univyear) : "Yes"

added macro:
             e(pscore) : "Yes"

added scalar:
              e(ftest) =  .

added macro:
            e(dptyear) : "Yes"

added macro:
              e(contr) : "Yes"

added macro:
           e(univyear) : "No"

added macro:
             e(pscore) : "No"

added scalar:
              e(ftest) =  .

added macro:
            e(dptyear) : "Yes"

added macro:
              e(contr) : "Yes"

added macro:
           e(univyear) : "Yes"

added macro:
             e(pscore) : "No"

added scalar:
              e(ftest) =  .

added macro:
            e(dptyear) : "Yes"

added macro:
              e(contr) : "Yes"

added macro:
           e(univyear) : "Yes"

added macro:
             e(pscore) : "Yes"

. 
. 
. 
. * --------------------------------------------------
. * Table 4: DDD — Faculty Recruitment
. * --------------------------------------------------
.  esttab $y1 using "${output}/Table_04.${tab_fmt}", ///
>     keep(1.treated#1.L*#*post2 lagi dep_transfer_horizontal ///
>          tot_premiale VA_percap unemp_rate) ///
>     drop(1.treated#1.LOWdep#0.post2) ///
>     starlevels(+ 0.1 * 0.05 ** 0.01) ///
>     varlabels( ///
>         1.treated#1.LOWdep#1.post2 "Treat X Low X After" ///
>         lagi "# researchers" ///
>         dep_transfer_horizontal "# of transfers" ///
>         tot_premiale "amount of research funding" ///
>         VA_percap "value added per capita" ///
>         unemp_rate "unemployment rate") ///
>     cells(b(star fmt(3)) se(par([ ]) fmt(3))) ///
>     legend collabels(, none) ///
>     stats(dptyear contr univyear pscore N_clust, ///
>         labels("Department and post FE" ///
>                "Time-varying controls" ///
>                "University-by-post FE" ///
>                "Prop score weight" ///
>                "N (Departments)") fmt(0 0 0 0 0)) ///
>     addnotes("Notes. This table displays the average treatment on the treated coefficients for second tier departments using 2014-2020 data. Regressions are based on 2,029 department-year observations. Estimates include controls for the number of employ
> ees at t-1, the number of staff transferred between departments, university income linked to the VQR, province-level per-capita value added and provincial unemployment rate. Department, post treatment fixed effects are included in all specifications. Co
> lumns 2, 3, 5, 6, 8 and 9 also include university-by-post fixed effects. Regressions in columns 3, 6 and 9 are estimated using 1/(1-`phat'(x<sub>i</sub>)) to weight untreated observations and 1/`phat'(x<sub>i</sub>) otherwise. `phat'(x<sub>i</sub>) is t
> he propensity score and is calculated controlling for the number of department research staff at time t-1, the number of staff transferred between departments, university income linked to the VQR, province-level per-capita value added, provincial unempl
> oyment rate and NUTS 1 regional fixed effects. Standard errors clustered at the department level are in parentheses. ") ///
>     nogaps onecell ///
>     label ///
>     title("Table 4: Effect of the Department of Excellence Programme on University Faculty Recruitment for second tier university departments: new positions and internal promotions") ///
>     replace
(file output/Table_04.html not found)
(output written to output/Table_04.html)

. 
. * --------------------------------------------------
. * Table 5 - DDD Temporary & Tenure-Track
. * --------------------------------------------------
.  esttab $y2 using "${output}/Table_05.${tab_fmt}", ///
>     keep(1.treated#1.L*#*post2 lagi dep_transfer_horizontal ///
>          tot_premiale VA_percap unemp_rate) ///
>     drop(1.treated#1.LOWdep#0.post2) ///
>     starlevels(+ 0.1 * 0.05 ** 0.01) ///
>     varlabels( ///
>         1.treated#1.LOWdep#1.post2 "Treat X Low X After" ///
>         lagi "# researchers" ///
>         dep_transfer_horizontal "# of transfers" ///
>         tot_premiale "amount of research funding" ///
>         VA_percap "value added per capita" ///
>         unemp_rate "unemployment rate") ///
>     cells(b(star fmt(3)) se(par([ ]) fmt(3))) ///
>     legend collabels(, none) ///
>     stats(dptyear contr univyear pscore N_clust, ///
>         labels("Department and post FE" ///
>                "Time-varying controls" ///
>                "University-by-post FE" ///
>                "Prop score weight" ///
>                "N (Departments)") fmt(0 0 0 0 0)) ///
>     addnotes("Notes. This table displays the average treatment on the treated coefficients for second tier departments using 2014-2020 data. Regressions are based on 2,029 department-year observations. Estimates include controls for the number of employ
> ees at t-1, the number of staff transferred between departments, university income linked to the VQR, province-level per-capita value added and provincial unemployment rate. Department, post treatment fixed effects are included in all specifications. Co
> lumns 2, 3, 5, 6, 8 and 9 also include university-by-post fixed effects. Regressions in columns 3, 6 and 9 are estimated using 1/(1-`phat'(x<sub>i</sub>)) to weight untreated observations and 1/`phat'(x<sub>i</sub>) otherwise. `phat'(x<sub>i</sub>) is t
> he propensity score and is calculated controlling for the number of department research staff at time t-1, the number of staff transferred between departments, university income linked to the VQR, province-level per-capita value added, provincial unempl
> oyment rate and NUTS 1 regional fixed effects. Standard errors clustered at the department level are in parentheses") ///
>     nogaps onecell ///
>     label ///
>     title("Table 5: Effect of the Department of Excellence Programme on University Faculty Recruitment for second tier university departments: temporary and permanent positions") ///
>     replace
(file output/Table_05.html not found)
(output written to output/Table_05.html)

. 
.         
.         
. * --------------------------------------------------
. * Sanity Checks: Variable Means
. * --------------------------------------------------
. 
. quietly summarize treated, meanonly

. assert abs(r(mean) - 0.5103448) < 1e-6

. 
. quietly summarize LOWdep, meanonly

. assert abs(r(mean) - 0.4862069) < 1e-6

. 
. quietly summarize post2, meanonly

. assert abs(r(mean) - 0.4285714) < 1e-6

. .         include $script_path/03_group_eff_table_6.do

. * --------------------------------------------------
. * Project: Beyond the Badge of Honour: The Effect of
. * the Italian (Department of) Excellence Initiative
. * on Staff Recruitment
. * Author: Francesco Rentocchini and Ugo Rizzo
. * Date: 12 Nov 2025
. *
. * Code Description
. * - Purpose: Estimate fully interacted DDD models with contrasts on staff
. *   recruitment outcomes using inverse-probability weights and high-dim FE.
. *       report DDD contrasts in a table
. * - Data inputs: ${data_path}/data_for_analysis.dta
. * - Expected outputs: ${output}/Table_06.csv (custom CSV table with DDD
. *   contrasts, SEs, p-values, and N of departments)
. * --------------------------------------------------
. 
. * --------------------------------------------------
. * Globals & locals (SET GLOBALS AND LOCALS FOR ANALYSIS)
. * --------------------------------------------------
. 
. global covar lagi dep_transfer_horizontal tot_premiale VA_percap ///
>     unemp_rate

. 
. global y new_position new_entry new_endogamia new_rtda ///
>     new_rtdb new_ten_uni_all

. 
. use "${data_path}/data_for_analysis.dta", clear
(Italian Department of Excellence panel data 2013-2020)

. 
. * --------------------------------------------------
. * Fully Interacted DDD with Contrasts
. * (stores key contrasts via estadd; keeps N of departments)
. * --------------------------------------------------
. foreach var of global y {
  2.     qui reghdfe `var' i.treated##i.post2##i.LOWdep $covar ///
>         [pweight=w_ipw_pre], ///
>         a(id i.post2 i.uni_name_enc#i.post2) cluster(id)
  3. 
.     * Column 1: Treat × Post × Second-tier (main DDD coefficient)
.     * This is the coefficient on 1.treated#1.post2#1.LOWdep
.     estadd scalar b_col1 = _b[1.treated#1.post2#1.LOWdep]
  4.     estadd scalar se_col1 = _se[1.treated#1.post2#1.LOWdep]
  5.     test 1.treated#1.post2#1.LOWdep = 0
  6.     estadd scalar p_col1 = r(p)
  7. 
.     * Column 2: Second-tier Funded vs Non-funded (treated=1, LOW=1 vs LOW=0)
.     * T vs NT | LOW = 1
.     di in red "++++ `var' Col 2: Second-tier Funded vs Non-funded +++++"
  8.     lincom _b[1.treated#1.LOWdep#1.post2] + _b[1.treated#1.post2]
  9.     estadd scalar b_col2 = r(estimate)
 10.     estadd scalar se_col2 = r(se)
 11.     estadd scalar p_col2 = r(p)
 12. 
.     * Column 3: First-tier Funded vs Non-funded (treated=1, LOW=0)
.     * T vs NT | LOW = 0
.     di in red "++++ `var' Col 3: First-tier Funded vs Non-funded +++++"
 13.     lincom _b[1.treated#1.post2]
 14.     estadd scalar b_col3 = r(estimate)
 15.     estadd scalar se_col3 = r(se)
 16.     estadd scalar p_col3 = r(p)
 17. 
.     * Column 4: Funded Second-tier vs First-tier (treated=1)
.     * LOW vs HIGH | T = 1
.     di in red "++++ `var' Col 4: Funded Second-tier vs First-tier +++++"
 18.     lincom _b[1.treated#1.LOWdep#1.post2] + _b[1.LOWdep#1.post2]
 19.     estadd scalar b_col4 = r(estimate)
 20.     estadd scalar se_col4 = r(se)
 21.     estadd scalar p_col4 = r(p)
 22. 
.     * Column 5: Non-funded Second-tier vs First-tier (treated=0)
.     * LOW vs HIGH | T = 0
.     di in red "++++ `var' Col 5: Non-funded Second-tier vs First-tier +++++"
 23.     lincom _b[1.LOWdep#1.post2]
 24.     estadd scalar b_col5 = r(estimate)
 25.     estadd scalar se_col5 = r(se)
 26.     estadd scalar p_col5 = r(p)
 27. 
.     * Store N (departments)
.     qui distinct id if e(sample)
 28.     estadd scalar N_dept = r(ndistinct)
 29. 
.     est store est_`var'
 30. }

added scalar:
             e(b_col1) =  2.2492422

added scalar:
            e(se_col1) =  .8112967

 ( 1)  1.treated#1.post2#1.LOWdep = 0

       F(  1,   289) =    7.69
            Prob > F =    0.0059

added scalar:
             e(p_col1) =  .00592588
++++ new_position Col 2: Second-tier Funded vs Non-funded +++++

 ( 1)  1.treated#1.post2 + 1.treated#1.post2#1.LOWdep = 0

------------------------------------------------------------------------------
new_position | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
         (1) |   2.247846   .6774382     3.32   0.001      .914508    3.581184
------------------------------------------------------------------------------

added scalar:
             e(b_col2) =  2.2478461

added scalar:
            e(se_col2) =  .67743818

added scalar:
             e(p_col2) =  .00102216
++++ new_position Col 3: First-tier Funded vs Non-funded +++++

 ( 1)  1.treated#1.post2 = 0

------------------------------------------------------------------------------
new_position | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
         (1) |  -.0013961   .4894202    -0.00   0.998    -.9646761     .961884
------------------------------------------------------------------------------

added scalar:
             e(b_col3) =  -.00139607

added scalar:
            e(se_col3) =  .48942024

added scalar:
             e(p_col3) =  .997726
++++ new_position Col 4: Funded Second-tier vs First-tier +++++

 ( 1)  1.post2#1.LOWdep + 1.treated#1.post2#1.LOWdep = 0

------------------------------------------------------------------------------
new_position | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
         (1) |   1.425761   .7160678     1.99   0.047      .016392     2.83513
------------------------------------------------------------------------------

added scalar:
             e(b_col4) =  1.4257613

added scalar:
            e(se_col4) =  .71606779

added scalar:
             e(p_col4) =  .04741144
++++ new_position Col 5: Non-funded Second-tier vs First-tier +++++

 ( 1)  1.post2#1.LOWdep = 0

------------------------------------------------------------------------------
new_position | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
         (1) |   -.823481   .5015644    -1.64   0.102    -1.810663    .1637013
------------------------------------------------------------------------------

added scalar:
             e(b_col5) =  -.82348096

added scalar:
            e(se_col5) =  .50156438

added scalar:
             e(p_col5) =  .10171396

added scalar:
             e(N_dept) =  290

added scalar:
             e(b_col1) =  1.2385294

added scalar:
            e(se_col1) =  .48898192

 ( 1)  1.treated#1.post2#1.LOWdep = 0

       F(  1,   289) =    6.42
            Prob > F =    0.0118

added scalar:
             e(p_col1) =  .01184229
++++ new_entry Col 2: Second-tier Funded vs Non-funded +++++

 ( 1)  1.treated#1.post2 + 1.treated#1.post2#1.LOWdep = 0

------------------------------------------------------------------------------
   new_entry | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
         (1) |   1.655161   .3729778     4.44   0.000     .9210638    2.389258
------------------------------------------------------------------------------

added scalar:
             e(b_col2) =  1.6551611

added scalar:
            e(se_col2) =  .3729778

added scalar:
             e(p_col2) =  .00001295
++++ new_entry Col 3: First-tier Funded vs Non-funded +++++

 ( 1)  1.treated#1.post2 = 0

------------------------------------------------------------------------------
   new_entry | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
         (1) |   .4166317   .3353489     1.24   0.215    -.2434041    1.076668
------------------------------------------------------------------------------

added scalar:
             e(b_col3) =  .41663173

added scalar:
            e(se_col3) =  .33534887

added scalar:
             e(p_col3) =  .21510246
++++ new_entry Col 4: Funded Second-tier vs First-tier +++++

 ( 1)  1.post2#1.LOWdep + 1.treated#1.post2#1.LOWdep = 0

------------------------------------------------------------------------------
   new_entry | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
         (1) |   1.011963   .3852265     2.63   0.009     .2537581    1.770169
------------------------------------------------------------------------------

added scalar:
             e(b_col4) =  1.0119634

added scalar:
            e(se_col4) =  .38522651

added scalar:
             e(p_col4) =  .00907554
++++ new_entry Col 5: Non-funded Second-tier vs First-tier +++++

 ( 1)  1.post2#1.LOWdep = 0

------------------------------------------------------------------------------
   new_entry | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
         (1) |   -.226566   .3257054    -0.70   0.487    -.8676215    .4144895
------------------------------------------------------------------------------

added scalar:
             e(b_col5) =  -.22656601

added scalar:
            e(se_col5) =  .3257054

added scalar:
             e(p_col5) =  .48722809

added scalar:
             e(N_dept) =  290

added scalar:
             e(b_col1) =  1.0600395

added scalar:
            e(se_col1) =  .51442209

 ( 1)  1.treated#1.post2#1.LOWdep = 0

       F(  1,   289) =    4.25
            Prob > F =    0.0402

added scalar:
             e(p_col1) =  .04023202
++++ new_endogamia Col 2: Second-tier Funded vs Non-funded +++++

 ( 1)  1.treated#1.post2 + 1.treated#1.post2#1.LOWdep = 0

------------------------------------------------------------------------------
new_endoga~a | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
         (1) |    .520695    .368351     1.41   0.159    -.2042958    1.245686
------------------------------------------------------------------------------

added scalar:
             e(b_col2) =  .52069495

added scalar:
            e(se_col2) =  .36835099

added scalar:
             e(p_col2) =  .1585604
++++ new_endogamia Col 3: First-tier Funded vs Non-funded +++++

 ( 1)  1.treated#1.post2 = 0

------------------------------------------------------------------------------
new_endoga~a | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
         (1) |  -.5393445   .3733138    -1.44   0.150    -1.274103    .1954141
------------------------------------------------------------------------------

added scalar:
             e(b_col3) =  -.53934451

added scalar:
            e(se_col3) =  .37331378

added scalar:
             e(p_col3) =  .14961189
++++ new_endogamia Col 4: Funded Second-tier vs First-tier +++++

 ( 1)  1.post2#1.LOWdep + 1.treated#1.post2#1.LOWdep = 0

------------------------------------------------------------------------------
new_endoga~a | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
         (1) |   .4435207   .3997486     1.11   0.268     -.343267    1.230308
------------------------------------------------------------------------------

added scalar:
             e(b_col4) =  .44352071

added scalar:
            e(se_col4) =  .39974859

added scalar:
             e(p_col4) =  .26813728
++++ new_endogamia Col 5: Non-funded Second-tier vs First-tier +++++

 ( 1)  1.post2#1.LOWdep = 0

------------------------------------------------------------------------------
new_endoga~a | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
         (1) |  -.6165188   .3748496    -1.64   0.101      -1.3543    .1212626
------------------------------------------------------------------------------

added scalar:
             e(b_col5) =  -.61651875

added scalar:
            e(se_col5) =  .37484957

added scalar:
             e(p_col5) =  .10111692

added scalar:
             e(N_dept) =  290

added scalar:
             e(b_col1) =  .29646344

added scalar:
            e(se_col1) =  .31405523

 ( 1)  1.treated#1.post2#1.LOWdep = 0

       F(  1,   289) =    0.89
            Prob > F =    0.3460

added scalar:
             e(p_col1) =  .34596579
++++ new_rtda Col 2: Second-tier Funded vs Non-funded +++++

 ( 1)  1.treated#1.post2 + 1.treated#1.post2#1.LOWdep = 0

------------------------------------------------------------------------------
    new_rtda | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
         (1) |   .6434441   .2304509     2.79   0.006     .1898691    1.097019
------------------------------------------------------------------------------

added scalar:
             e(b_col2) =  .64344408

added scalar:
            e(se_col2) =  .23045093

added scalar:
             e(p_col2) =  .00558575
++++ new_rtda Col 3: First-tier Funded vs Non-funded +++++

 ( 1)  1.treated#1.post2 = 0

------------------------------------------------------------------------------
    new_rtda | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
         (1) |   .3469806   .2231864     1.55   0.121    -.0922964    .7862576
------------------------------------------------------------------------------

added scalar:
             e(b_col3) =  .34698064

added scalar:
            e(se_col3) =  .22318645

added scalar:
             e(p_col3) =  .12111975
++++ new_rtda Col 4: Funded Second-tier vs First-tier +++++

 ( 1)  1.post2#1.LOWdep + 1.treated#1.post2#1.LOWdep = 0

------------------------------------------------------------------------------
    new_rtda | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
         (1) |   .5182536   .2342131     2.21   0.028     .0572739    .9792333
------------------------------------------------------------------------------

added scalar:
             e(b_col4) =  .51825356

added scalar:
            e(se_col4) =  .23421309

added scalar:
             e(p_col4) =  .02769681
++++ new_rtda Col 5: Non-funded Second-tier vs First-tier +++++

 ( 1)  1.post2#1.LOWdep = 0

------------------------------------------------------------------------------
    new_rtda | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
         (1) |   .2217901   .2378882     0.93   0.352    -.2464229    .6900032
------------------------------------------------------------------------------

added scalar:
             e(b_col5) =  .22179012

added scalar:
            e(se_col5) =  .23788817

added scalar:
             e(p_col5) =  .35194459

added scalar:
             e(N_dept) =  290

added scalar:
             e(b_col1) =  1.0454549

added scalar:
            e(se_col1) =  .24917733

 ( 1)  1.treated#1.post2#1.LOWdep = 0

       F(  1,   289) =   17.60
            Prob > F =    0.0000

added scalar:
             e(p_col1) =  .00003624
++++ new_rtdb Col 2: Second-tier Funded vs Non-funded +++++

 ( 1)  1.treated#1.post2 + 1.treated#1.post2#1.LOWdep = 0

------------------------------------------------------------------------------
    new_rtdb | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
         (1) |   .8585808   .1876691     4.57   0.000     .4892092    1.227952
------------------------------------------------------------------------------

added scalar:
             e(b_col2) =  .85858077

added scalar:
            e(se_col2) =  .18766913

added scalar:
             e(p_col2) =  7.077e-06
++++ new_rtdb Col 3: First-tier Funded vs Non-funded +++++

 ( 1)  1.treated#1.post2 = 0

------------------------------------------------------------------------------
    new_rtdb | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
         (1) |  -.1868741   .1687606    -1.11   0.269    -.5190298    .1452816
------------------------------------------------------------------------------

added scalar:
             e(b_col3) =  -.18687412

added scalar:
            e(se_col3) =  .16876059

added scalar:
             e(p_col3) =  .26907091
++++ new_rtdb Col 4: Funded Second-tier vs First-tier +++++

 ( 1)  1.post2#1.LOWdep + 1.treated#1.post2#1.LOWdep = 0

------------------------------------------------------------------------------
    new_rtdb | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
         (1) |   .6201155   .1977869     3.14   0.002       .23083    1.009401
------------------------------------------------------------------------------

added scalar:
             e(b_col4) =  .62011546

added scalar:
            e(se_col4) =  .19778693

added scalar:
             e(p_col4) =  .00189375
++++ new_rtdb Col 5: Non-funded Second-tier vs First-tier +++++

 ( 1)  1.post2#1.LOWdep = 0

------------------------------------------------------------------------------
    new_rtdb | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
         (1) |  -.4253394   .1741544    -2.44   0.015    -.7681112   -.0825676
------------------------------------------------------------------------------

added scalar:
             e(b_col5) =  -.42533943

added scalar:
            e(se_col5) =  .1741544

added scalar:
             e(p_col5) =  .01519274

added scalar:
             e(N_dept) =  290

added scalar:
             e(b_col1) =  .42960585

added scalar:
            e(se_col1) =  .24788059

 ( 1)  1.treated#1.post2#1.LOWdep = 0

       F(  1,   289) =    3.00
            Prob > F =    0.0841

added scalar:
             e(p_col1) =  .08414169
++++ new_ten_uni_all Col 2: Second-tier Funded vs Non-funded +++++

 ( 1)  1.treated#1.post2 + 1.treated#1.post2#1.LOWdep = 0

------------------------------------------------------------------------------
new_ten_un~l | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
         (1) |   .4638685    .196493     2.36   0.019     .0771297    .8506072
------------------------------------------------------------------------------

added scalar:
             e(b_col2) =  .46386846

added scalar:
            e(se_col2) =  .196493

added scalar:
             e(p_col2) =  .01890263
++++ new_ten_uni_all Col 3: First-tier Funded vs Non-funded +++++

 ( 1)  1.treated#1.post2 = 0

------------------------------------------------------------------------------
new_ten_un~l | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
         (1) |   .0342626   .1511775     0.23   0.821    -.2632859    .3318111
------------------------------------------------------------------------------

added scalar:
             e(b_col3) =  .03426261

added scalar:
            e(se_col3) =  .15117751

added scalar:
             e(p_col3) =  .82086526
++++ new_ten_uni_all Col 4: Funded Second-tier vs First-tier +++++

 ( 1)  1.post2#1.LOWdep + 1.treated#1.post2#1.LOWdep = 0

------------------------------------------------------------------------------
new_ten_un~l | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
         (1) |   .2436491   .2071723     1.18   0.241    -.1641087    .6514069
------------------------------------------------------------------------------

added scalar:
             e(b_col4) =  .24364908

added scalar:
            e(se_col4) =  .20717226

added scalar:
             e(p_col4) =  .24053477
++++ new_ten_uni_all Col 5: Non-funded Second-tier vs First-tier +++++

 ( 1)  1.post2#1.LOWdep = 0

------------------------------------------------------------------------------
new_ten_un~l | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
         (1) |  -.1859568   .1577948    -1.18   0.240    -.4965295    .1246159
------------------------------------------------------------------------------

added scalar:
             e(b_col5) =  -.18595677

added scalar:
            e(se_col5) =  .15779477

added scalar:
             e(p_col5) =  .23957777

added scalar:
             e(N_dept) =  290

. 
. * --------------------------------------------------
. * Manual table construction for exact formatting
. * (CSV headers, rows: coefficients with stars, SEs, N)
. * --------------------------------------------------
. cap file close mytable

. file open mytable using "${output}/Table_06.csv", write replace
(file output/Table_06.csv not found)

. 
. * Write headers
. file write mytable "" ///
>     ",Treat X Post X Second-tier" ///
>     ",Second-tier Funded vs Non-funded" ///
>     ",First-tier Funded vs Non-funded" ///
>     ",Funded Second-tier vs First-tier" ///
>     ",Non-funded Second-tier vs First-tier" ///
>     ",N (Departments)" _n

. 
. file write mytable "" ///
>     ",[1],[2],[3],[4],[5]," _n

. 
. * Loop through each outcome variable
. local varlist "new_position new_entry new_endogamia new_rtda new_rtdb new_ten_uni_all"

. local varlabels `" "New positions" "New positions (excl. promotions)" "Internal promotions" "Temporary" "Tenure track" "Tenured" "'

. 
. local i = 1

. foreach var of local varlist {
  2.     local vlab : word `i' of `varlabels'
  3. 
.     * Get stored estimates
.     qui est restore est_`var'
  4. 
.     * Extract coefficients and SEs
.     local b1 = e(b_col1)
  5.     local se1 = e(se_col1)
  6.     local p1 = e(p_col1)
  7. 
.     local b2 = e(b_col2)
  8.     local se2 = e(se_col2)
  9.     local p2 = e(p_col2)
 10. 
.     local b3 = e(b_col3)
 11.     local se3 = e(se_col3)
 12.     local p3 = e(p_col3)
 13. 
.     local b4 = e(b_col4)
 14.     local se4 = e(se_col4)
 15.     local p4 = e(p_col4)
 16. 
.     local b5 = e(b_col5)
 17.     local se5 = e(se_col5)
 18.     local p5 = e(p_col5)
 19. 
.     local n_dept = e(N_dept)
 20. 
.     * Add significance stars
.     local star1 = ""
 21.     if `p1' < 0.01 local star1 = "**"
 22.     else if `p1' < 0.05 local star1 = "*"
 23.     else if `p1' < 0.1 local star1 = "+"
 24. 
.     local star2 = ""
 25.     if `p2' < 0.01 local star2 = "**"
 26.     else if `p2' < 0.05 local star2 = "*"
 27.     else if `p2' < 0.1 local star2 = "+"
 28. 
.     local star3 = ""
 29.     if `p3' < 0.01 local star3 = "**"
 30.     else if `p3' < 0.05 local star3 = "*"
 31.     else if `p3' < 0.1 local star3 = "+"
 32. 
.     local star4 = ""
 33.     if `p4' < 0.01 local star4 = "**"
 34.     else if `p4' < 0.05 local star4 = "*"
 35.     else if `p4' < 0.1 local star4 = "+"
 36. 
.     local star5 = ""
 37.     if `p5' < 0.01 local star5 = "**"
 38.     else if `p5' < 0.05 local star5 = "*"
 39.     else if `p5' < 0.1 local star5 = "+"
 40. 
.     * Write coefficient row
.     file write mytable "`vlab'" ///
>         "," %4.3f (`b1') "`star1'" ///
>         "," %4.3f (`b2') "`star2'" ///
>         "," %4.3f (`b3') "`star3'" ///
>         "," %4.3f (`b4') "`star4'" ///
>         "," %4.3f (`b5') "`star5'" ///
>         "," (`n_dept') _n
 41. 
.     * Write standard error row
.     file write mytable "" ///
>         ",[" %4.3f (`se1') "]" ///
>         ",[" %4.3f (`se2') "]" ///
>         ",[" %4.3f (`se3') "]" ///
>         ",[" %4.3f (`se4') "]" ///
>         ",[" %4.3f (`se5') "]" ///
>         "," _n
 42. 
.     local i = `i' + 1
 43. }

. 
. file close mytable

. . }

. 
. // Run robustness checks
. if $robcheck == 1 {
.         include $script_path/04_rob_check_pt_tables_7to8.do

. /*==================================================================
> Author: Francesco Rentocchini
> Current Date: 21 April 2025
> Project Name: Department of Excellence Project
> 
> Code Description:
> This script implements parallel trends checks using both DD and DDD 
> event study specifications. The first block evaluates conditional PT 
> (on covariates), while the second runs the test without conditioning.
> These are robustness checks to support identifying assumptions.
> 
> Inputs:
> - db_robcheck.dta: Department-year panel data, pre-treatment only
> 
> Outputs:
> - tables_RC07_PT.[format]: DD and DDD tables (conditional PT)
> - tables_RC08_UPT.[format]: DD and DDD tables (unconditional PT)
> ==================================================================*/
. 
. 
. * --------------------------------------------------
. * Project: Beyond the Badge of Honour: The Effect of
. * the Italian (Department of) Excellence Initiative
. * on Staff Recruitment
. * Author: Francesco Rentocchini and Ugo Rizzo
. * Date: 12 Nov 2025
. *
. * Code Description
. * - Purpose: Check parallel-trend assumptions with DD models:
. *   (i) conditional on covariates and FEs; (ii) unconditional.
. * - Data inputs: ${data_path}/data_for_analysis.dta
. * - Expected outputs:
. *   - ${output}/Table_07.${tab_fmt} (conditional PT test)
. *   - ${output}/Table_08.${tab_fmt} (unconditional PT test)
. * --------------------------------------------------
. 
. * --------------------------------------------------
. * Globals & locals (SET GLOBALS AND LOCALS FOR ANALYSIS)
. * --------------------------------------------------
. 
. global covar lagi dep_transfer_horizontal tot_premiale VA_percap ///
>     unemp_rate

. 
. global y new_position new_entry new_endogamia new_rtda ///
>     new_rtdb new_ten_uni_all

. 
. global y1 est*_new_position est*_new_entry est*_new_endogamia

. global y2 est*_new_rtda est*_new_rtdb est*_new_ten_uni_all

. 
. global plot_y1 est3_new_position est3_new_entry est3_new_endogamia

. global plot_y2 est3_new_rtda est3_new_rtdb est3_new_ten_uni_all

. 
. * p hat in notes to tables
. local hat = uchar(770)

. local phat = "p`hat'"

. 
. * --------------------------------------------------
. * Conditional parallel trends (WITH COVARIATES)
. * --------------------------------------------------
. 
. use "${data_path}/data_for_analysis.dta", clear
(Italian Department of Excellence panel data 2013-2020)

. keep if year <= 2017
(870 observations deleted)

. 
. cap est drop _all

. 
. foreach var of global y {
  2. 
.     * Conditional PT test: DD model
.     qui reghdfe `var' ib0.treated##b2017.year $covar ///
>         [pweight=w_ipw_pre], ///
>         a(id i.uni_name_enc#i.year) cluster(id)
  3.     test 1.treated#2014.year 1.treated#2015.year 1.treated#2016.year
  4.     estadd scalar ftest = r(p)
  5.     estadd local dptyear "Yes"
  6.     estadd local contr "Yes"
  7.     estadd local univyear "Yes"
  8.     estadd local pscore "Yes"
  9.     est store est3_`var'
 10. 
. }

 ( 1)  1.treated#2014.year = 0
 ( 2)  1.treated#2015.year = 0
 ( 3)  1.treated#2016.year = 0

       F(  3,   275) =    0.76
            Prob > F =    0.5172

added scalar:
              e(ftest) =  .51715246

added macro:
            e(dptyear) : "Yes"

added macro:
              e(contr) : "Yes"

added macro:
           e(univyear) : "Yes"

added macro:
             e(pscore) : "Yes"

 ( 1)  1.treated#2014.year = 0
 ( 2)  1.treated#2015.year = 0
 ( 3)  1.treated#2016.year = 0

       F(  3,   275) =    0.14
            Prob > F =    0.9350

added scalar:
              e(ftest) =  .93495645

added macro:
            e(dptyear) : "Yes"

added macro:
              e(contr) : "Yes"

added macro:
           e(univyear) : "Yes"

added macro:
             e(pscore) : "Yes"

 ( 1)  1.treated#2014.year = 0
 ( 2)  1.treated#2015.year = 0
 ( 3)  1.treated#2016.year = 0

       F(  3,   275) =    1.47
            Prob > F =    0.2239

added scalar:
              e(ftest) =  .22393347

added macro:
            e(dptyear) : "Yes"

added macro:
              e(contr) : "Yes"

added macro:
           e(univyear) : "Yes"

added macro:
             e(pscore) : "Yes"

 ( 1)  1.treated#2014.year = 0
 ( 2)  1.treated#2015.year = 0
 ( 3)  1.treated#2016.year = 0

       F(  3,   275) =    0.48
            Prob > F =    0.6983

added scalar:
              e(ftest) =  .69826664

added macro:
            e(dptyear) : "Yes"

added macro:
              e(contr) : "Yes"

added macro:
           e(univyear) : "Yes"

added macro:
             e(pscore) : "Yes"

 ( 1)  1.treated#2014.year = 0
 ( 2)  1.treated#2015.year = 0
 ( 3)  1.treated#2016.year = 0

       F(  3,   275) =    0.06
            Prob > F =    0.9807

added scalar:
              e(ftest) =  .98070758

added macro:
            e(dptyear) : "Yes"

added macro:
              e(contr) : "Yes"

added macro:
           e(univyear) : "Yes"

added macro:
             e(pscore) : "Yes"

 ( 1)  1.treated#2014.year = 0
 ( 2)  1.treated#2015.year = 0
 ( 3)  1.treated#2016.year = 0

       F(  3,   275) =    0.89
            Prob > F =    0.4451

added scalar:
              e(ftest) =  .44510355

added macro:
            e(dptyear) : "Yes"

added macro:
              e(contr) : "Yes"

added macro:
           e(univyear) : "Yes"

added macro:
             e(pscore) : "Yes"

. 
. * --------------------------------------------------
. * Export: Table 7 (DD conditional PT)
. * --------------------------------------------------
. 
. esttab $y1 $y2 using "${output}/Table_07.${tab_fmt}", ///
>     keep(1.treated#*) starlevels(+ 0.1 * 0.05 ** 0.01) ///
>     varlabels( ///
>         1.treated#2014.year "Treat X Year 2014" ///
>         1.treated#2015.year "Treat X Year 2015" ///
>         1.treated#2016.year "Treat X Year 2016" ///
>         1.treated#2017.year "Treat X Year 2017 (omitted)" ///
>         1.treated#2018.year "Treat X Year 2018" ///
>         1.treated#2019.year "Treat X Year 2019" ///
>         1.treated#2020.year "Treat X Year 2020" ///
>         lagi "# researchers -1" ///
>         dep_transfer_horizontal "# of transfers" ///
>         tot_premiale "amount of research funding" ///
>         VA_percap "value added per capita" ///
>         unemp_rate "unemployment rate") ///
>     cells(b(star fmt(3)) se(par([ ]) fmt(3))) ///
>     legend collabels(, none) ///
>     stats(dptyear contr univyear pscore ftest N N_clust, ///
>         labels( ///
>         "Department and post FE" ///
>         "Time-varying controls" ///
>         "University-by-post FE" ///
>         "Prop score weight" ///
>         "Joint p-value" ///
>         "N (Departments X year)" "N (Departments)") ///
>         fmt(0 0 0 0 3 0 0)) ///
>     addnotes("Notes. This table displays the pre-treatment event study coefficients using 2014-2016 data. Regressions are based on 1,104 department-year observations. Estimates include controls for the number of employees at t-1, the number of staff tra
> nsferred between departments, university income linked to the VQR, province-level per-capita value added and provincial unemployment rate. Department, year and university-by-year fixed effects are included in all specifications. All regressions are esti
> mated using 1/(1-`phat'(x<sub>i</sub>)) to weight untreated observations and 1/`phat'(x<sub>i</sub>) otherwise. `phat'(x<sub>i</sub>)  is the propensity score and is calculated controlling for the number of department research staff at time t-1, the num
> ber of staff transferred between departments, university income linked to the VQR, province-level per-capita value added, provincial unemployment rate and NUTS 1 regional fixed effects. Standard errors clustered at the department level are in parenthese
> s.") ///
>     nogaps onecell noomitted ///
>     mtitles("New positions" "New positions (excl. promotions)" ///
>     "Internal promotions" "Temporary" "Tenure track" "Tenured") ///
>     label ///
>     title("Table 7: Pre-treatment trends: parallel trend assumption") ///
>     replace
(file output/Table_07.html not found)
(output written to output/Table_07.html)

. 
. * --------------------------------------------------
. * Unconditional parallel trends test (NO COVARIATES)
. * --------------------------------------------------
. 
. use "${data_path}/data_for_analysis.dta", clear
(Italian Department of Excellence panel data 2013-2020)

. keep if year >= 2014 & year <= 2017
(1,160 observations deleted)

. 
. cap est drop _all

. 
. foreach var of global y {
  2. 
.     * Unconditional PT test: DD model
.     qui reghdfe `var' ib0.treated##b2017.year ///
>         [pweight=w_ipw_pre], ///
>         a(id) cluster(id)
  3.     test 1.treated#2014.year 1.treated#2015.year 1.treated#2016.year
  4.     estadd scalar ftest = r(p)
  5.     estadd local dptyear "Yes"
  6.     estadd local contr "No"
  7.     estadd local univyear "No"
  8.     estadd local pscore "Yes"
  9.     est store est3_`var'
 10. 
. }

 ( 1)  1.treated#2014.year = 0
 ( 2)  1.treated#2015.year = 0
 ( 3)  1.treated#2016.year = 0

       F(  3,   289) =    0.14
            Prob > F =    0.9390

added scalar:
              e(ftest) =  .93898635

added macro:
            e(dptyear) : "Yes"

added macro:
              e(contr) : "No"

added macro:
           e(univyear) : "No"

added macro:
             e(pscore) : "Yes"

 ( 1)  1.treated#2014.year = 0
 ( 2)  1.treated#2015.year = 0
 ( 3)  1.treated#2016.year = 0

       F(  3,   289) =    0.46
            Prob > F =    0.7123

added scalar:
              e(ftest) =  .71233743

added macro:
            e(dptyear) : "Yes"

added macro:
              e(contr) : "No"

added macro:
           e(univyear) : "No"

added macro:
             e(pscore) : "Yes"

 ( 1)  1.treated#2014.year = 0
 ( 2)  1.treated#2015.year = 0
 ( 3)  1.treated#2016.year = 0

       F(  3,   289) =    0.83
            Prob > F =    0.4790

added scalar:
              e(ftest) =  .47901596

added macro:
            e(dptyear) : "Yes"

added macro:
              e(contr) : "No"

added macro:
           e(univyear) : "No"

added macro:
             e(pscore) : "Yes"

 ( 1)  1.treated#2014.year = 0
 ( 2)  1.treated#2015.year = 0
 ( 3)  1.treated#2016.year = 0

       F(  3,   289) =    1.11
            Prob > F =    0.3433

added scalar:
              e(ftest) =  .34333679

added macro:
            e(dptyear) : "Yes"

added macro:
              e(contr) : "No"

added macro:
           e(univyear) : "No"

added macro:
             e(pscore) : "Yes"

 ( 1)  1.treated#2014.year = 0
 ( 2)  1.treated#2015.year = 0
 ( 3)  1.treated#2016.year = 0

       F(  3,   289) =    0.04
            Prob > F =    0.9909

added scalar:
              e(ftest) =  .9909067

added macro:
            e(dptyear) : "Yes"

added macro:
              e(contr) : "No"

added macro:
           e(univyear) : "No"

added macro:
             e(pscore) : "Yes"

 ( 1)  1.treated#2014.year = 0
 ( 2)  1.treated#2015.year = 0
 ( 3)  1.treated#2016.year = 0

       F(  3,   289) =    0.87
            Prob > F =    0.4587

added scalar:
              e(ftest) =  .45869574

added macro:
            e(dptyear) : "Yes"

added macro:
              e(contr) : "No"

added macro:
           e(univyear) : "No"

added macro:
             e(pscore) : "Yes"

. 
. * --------------------------------------------------
. * Export: Table 8 (DD unconditional PT)
. * --------------------------------------------------
. 
. esttab est3_* using "${output}/Table_08.${tab_fmt}", ///
>     keep(1.treated#*) starlevels(+ 0.1 * 0.05 ** 0.01) ///
>     varlabels( ///
>         1.treated#2014.year "Treat X Year 2014" ///
>         1.treated#2015.year "Treat X Year 2015" ///
>         1.treated#2016.year "Treat X Year 2016" ///
>         1.treated#2017.year "Treat X Year 2017 (omitted)" ///
>         1.treated#2018.year "Treat X Year 2018" ///
>         1.treated#2019.year "Treat X Year 2019" ///
>         1.treated#2020.year "Treat X Year 2020" ///
>         lagi "# researchers -1" ///
>         dep_transfer_horizontal "# of transfers" ///
>         tot_premiale "amount of research funding" ///
>         VA_percap "value added per capita" ///
>         unemp_rate "unemployment rate") ///
>     cells(b(star fmt(3)) se(par([ ]) fmt(3))) ///
>     legend collabels(, none) ///
>     stats(dptyear contr univyear pscore ftest N N_clust, ///
>         labels( ///
>         "Department and post FE" ///
>         "Time-varying controls" ///
>         "University-by-post FE" ///
>         "Prop score weight" "Joint p-value" ///
>         "N (Departments X year)" "N (Departments)") ///
>         fmt(0 0 0 0 3 0 0)) ///
>     addnotes("Notes. This table displays the pre-treatment event study coefficients using 2014-2016 data. Regressions are based on 1,160 department-year observations. Department and year fixed effects are included in all specifications. All regressions 
> are estimated using 1/(1-`phat'(x<sub>i</sub>)) to weight untreated observations and 1/`phat'(x<sub>i</sub>) otherwise. `phat'(x<sub>i</sub>) is the propensity score and is calculated controlling for the number of department research staff at time t-1, 
> the number of staff transferred between departments, university income linked to the VQR, province-level per-capita value added, provincial unemployment rate and NUTS 1 regional fixed effects. Standard errors clustered at the department level are in par
> entheses. ") ///
>     nogaps onecell noomitted ///
>     mtitles("New positions" "New positions (excl. promotions)" ///
>     "Internal promotions" "Temporary" "Tenure track" "Tenured") ///
>     label ///
>     title("Table 8: Pre-treatment trends with no controls: unconditional parallel trend") ///
>     replace
(file output/Table_08.html not found)
(output written to output/Table_08.html)

. . }

. 
. // Run robustness checks (time consuming one)
. if $robcheck_long == 1 {
.         include $script_path/05_sdid_table_9_fig_1.do

. * --------------------------------------------------
. * Project: Beyond the Badge of Honour: The Effect of
. * the Italian (Department of) Excellence Initiative
. * on Staff Recruitment
. * Author: Francesco Rentocchini and Ugo Rizzo
. * Date: 12 Nov 2025
. *
. * Code Description
. * - Purpose: Estimate SDID DD and DDD effects and produce figures/tables.
. * - Data inputs: ${data_path}/data_for_analysis.dta
. * - Expected outputs:
. *   - ${temp_path}/gr_<outcome>.gph (per-outcome graphs)
. *   - ${output}/Figure_01.png (combined figure)
. *   - ${output}/Table_09.${tab_fmt} (SDID DDD summary table)
. * --------------------------------------------------
. 
. * --------------------------------------------------
. * Globals & locals (SET GLOBALS AND LOCALS FOR ANALYSIS)
. * --------------------------------------------------
. 
. global covar lagi dep_transfer_horizontal tot_premiale VA_percap unemp_rate

. 
. global y new_position new_entry new_endogamia new_rtda new_rtdb new_ten_uni_all 

. 
. global reps 1000 // number of bootstrap replications

. 
. 
. 
. 
. * --------------------------------------------------
. * SDID DD ESTIMATES AND GRAPHS
. * --------------------------------------------------
. 
. use "${data_path}/data_for_analysis.dta",clear
(Italian Department of Excellence panel data 2013-2020)

. 
. 
. * Generate treatment indicator from 2018 onward
. gen treat_from2018 = treated

. replace treat_from2018 = 0 if treated == 1 & year < 2018
(740 real changes made)

. 
. * Keep relevant years and variables
. keep id year treat_from2018 $y $covar

. keep if year > 2013
(290 observations deleted)

. 
. * Drop unbalanced panels due to missing vars
. egen flag_miss = rowmiss($y $covar treat_from2018)

. bysort id: egen flag_miss2 = total(flag_miss)

. drop if flag_miss2 == 1
(7 observations deleted)

. drop flag_miss*

. 
. * Estimate SDID and generate graphs
. foreach var of global y {
  2.         set seed 150749
  3.     sdid `var' id year treat_from2018, ///
>         vce(bootstrap) covariates($covar) ///
>         reps(${reps}) seed(123) ///
>         graph
  4. 
.     matrix A = e(series)
  5.     matrix w = e(lambda)
  6.     matrix w2 = w[1..4,1]
  7.     matrix rownames A = 2014 2015 2016 2017 2018 2019 2020
  8.     matrix rownames w2 = 2014 2015 2016 2017
  9.     coefplot (matrix(A[,2]), lpattern("dash") label("Control")) ///
>         (matrix(A[,3]), label("Treated")) ///
>         (matrix(w2[,1]), recast(bar) color(%30) label("Lambda weights")), ///
>         vertical nooffsets recast(line) xline(4.5) ///
>         ytitle("`: variable label `var''", size(vsmall)) ///
>         legend(rows(1) pos(6)) ///
>         note( "ATT = `: display %-5.3f e(ATT)'" ///
>                 "SE = [`: display %-5.3f e(se)']", span size(.2cm))
 10. 
.     graph save "${temp_path}/gr_`var'.gph", replace
 11. }
Bootstrap replications (1000). This may take some time.
----+--- 1 ---+--- 2 ---+--- 3 ---+--- 4 ---+--- 5
..................................................     50
..................................................     100
.....................--Break--
r(1);
--Break--
r(1);
. }
--Break--
r(1);

end of do-file

--Break--
r(1);

